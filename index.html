<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Acesso de Administrador</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { inter: ['Inter', 'system-ui', 'ui-sans-serif']},
        }
      }
    }
  </script>
  <style>
    :root{--border:rgba(148,163,184,.25)}
    .input{border:1px solid var(--border);border-radius:12px;padding:.65rem .8rem;background:#0b1220;color:#f8fafc;transition:all .2s}
    .input:focus{box-shadow:0 0 0 3px rgba(37,99,235,.2);border-color:#2563eb}
    .btn-primary{background:#2563eb;color:#fff;border-radius:12px;padding:.65rem .95rem;font-weight:800;transition:transform .05s ease;box-shadow:0 10px 25px -10px rgba(37,99,235,.6)}
    .btn-primary:hover{background:#1d4ed8}
    .btn-primary:active{transform:translateY(1px)}
    #toast{background:#111827;color:#fff;border-radius:9999px;padding:.6rem 1rem;font-weight:800;box-shadow:0 10px 25px -12px rgba(0,0,0,.35)}
  </style>
  <script>
    (function() {
      document.documentElement.classList.add("dark");
    })();
  </script>
</head>
<body class="font-inter bg-slate-900 text-slate-100">

  <!-- Layout de Login Centralizado -->
  <div class="flex min-h-screen items-center justify-center p-4">
    <div class="w-full max-w-md rounded-2xl bg-slate-800 shadow-xl p-6">
      <div class="flex items-center gap-3 mb-4">
        <h2 class="text-xl font-extrabold">Acesso de Administrador</h2>
      </div>
      <p class="text-sm opacity-80 mb-4">Entre com seu usuário e senha.</p>
      <div class="grid gap-3">
        <input id="login-user" class="input" placeholder="Usuário" type="text">
        <input id="login-pin" class="input" placeholder="Senha" type="password">
        <button id="login-btn" class="btn-primary">Entrar</button>
      </div>
      <p id="login-msg" class="mt-3 text-sm text-red-500 hidden"></p>
    </div>
  </div>

  <div id="toast" class="fixed bottom-4 right-4 hidden"></div>

  <script type="module">
    /* ========================== Lógica de Login ========================== */
    const $ = (sel) => document.querySelector(sel);

    function toast(msg, kind="info"){
      const box = $("#toast");
      box.textContent = msg;
      box.classList.remove("hidden");
      box.style.background = kind==="error" ? "#ef4444" : (kind==="ok" ? "#065f46" : "#111827");
      setTimeout(()=>box.classList.add("hidden"), 3000);
    }
    
    // 1. Função auxiliar para calcular o hash SHA-256
    async function sha256(message) {
      const msgBuffer = new TextEncoder().encode(message);                    
      const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      return hashHex;
    }

    // 2. Hash da sua senha "752266"
    const USERS = { "admin": "19859f0d01d445b7617c60e31c6a2f1c8a1f7366113821731d7981329c1584c5" };

    // 3. Função de login modificada
    async function login(user, pin){
      user = (user||"").trim().toLowerCase();
      pin = (pin||"").trim();
      
      $("#login-btn").disabled = true;
      $("#login-btn").textContent = "Verificando...";
      
      if (USERS[user]) {
        const inputPinHash = await sha256(pin);
        
        // DEBUG:
        console.log("Hash Inserido:", inputPinHash);
        console.log("Hash Esperado:", USERS[user]);
        
        if (USERS[user] === inputPinHash) {
          const session = { user, ts: Date.now() };
          localStorage.setItem("sessionUser", JSON.stringify(session));
          toast("Bem-vindo!", "ok");
          
          // === REDIRECIONAMENTO ===
          window.location.href = "admin.html"; // Vai para a página de admin
          return true;
        }
      }

      $("#login-msg").classList.remove("hidden");
      $("#login-msg").textContent = "Usuário ou PIN inválidos.";
      $("#login-btn").disabled = false;
      $("#login-btn").textContent = "Entrar";
      return false;
    }

    // 4. Verificação de sessão
    function tryAutoLogin(){
      try {
        const raw = localStorage.getItem("sessionUser");
        if (!raw) return false;
        const sess = JSON.parse(raw);
        if (!sess || !USERS[sess.user]) return false;
        return true; // Apenas confirma que a sessão é válida
      } catch(e){ return false; }
    }

    /* ========================== Boot (Página de Login) ========================== */
    
    // Se já estiver logado, redireciona para o admin
    if (tryAutoLogin()) {
      window.location.href = "admin.html";
    }

    // Adiciona o evento de clique ao botão
    $("#login-btn").addEventListener("click", async () => {
      await login($("#login-user").value, $("#login-pin").value);
    });
    
    // Adiciona evento de "Enter"
    $("#login-pin").addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        $("#login-btn").click();
      }
    });
    $("#login-user").addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        $("#login-btn").click();
      }
    });

  </script>
</body>
</html>